**<center><font face="微软雅黑" size=10>三维弹道提前量计算(无风阻条件)</font></center>**

# 问题背景

在游戏中，遇到仿真的物理环境时，往往在战斗中需要计算弹道，而在游戏中能够获取的就是：当地的重力加速度、目标的速度和原始位置、自己的速度和原始位置、炮弹的初速率（标量），用这些来估计提前量，以求接近真实视觉效果:)。

大部分游戏是不会考虑风阻这项因素的，因此我们就在这里省略了这个项目。

# 符号定义

- $v_{target}$: 目标速度，可表示为$(x_{v_{target}},y_{v_{target}},z_{v_{target}})$
- $P_{target}$: 目标现在的位置，可表示为$(x_{P_{target}},y_{P_{target}},z_{P_{target}})$
- $v_{project}$: 弹头的初速度，可表示为$(x_{v_{project}},y_{v_{project}},z_{v_{project}})$
- $v_{me}$: 发射弹头的物体的速度，可表示为$(x_{v_{me}},y_{v_{me}},z_{v_{me}})$
- $g$: 当前作战区域的重力场，可表示为$(x_{g},y_{g},z_{g})$
- $P_{me}$: 发射弹头的物体当前的坐标，可表示为$(x_{P_{me}},y_{P_{me}},z_{P_{me}})$
- $P'_{target}$: 目标的位置，可表示为$(x_{P'_{target}},y_{P'_{target}},z_{P'_{target}})$
- $t$: 弹头和目标相遇经历的时间，是个标量

# 结果推导

问题公式表示

$$P'_{target}=\int^{t}_{0}v_{target}dt+P_{target} \tag{1}$$
$$P'_{target}=\int^{t}_{0}(v_{me}+v_{project}+\int^{t}_{0}gdt)dt+P_{me}\tag{2}$$

由于(1)和(2)都算出的是$P'_{target}$且所经历的时间都是$t$，因此开始调整合并运算方程为：

$$v_{target}t+P_{target}=v_{me}t+v_{project}t+\frac{1}{2}gt^{2}+P_{me}\tag{3}$$

已知弹头初速的长度为$\sqrt {||v_{project}||^2}$，但是方向未知，那么继续调整方程：
$$v_{project}t=(P_{target}-P_{me})+(v_{target}-v_{me})t-\frac{1}{2}gt^{2}\tag{4}$$

将方程写成对应坐标的方程：

$$\begin{cases}x_{v_{project}}t=(x_{v_{project}}-x_{P_{me}})+(x_{v_{target}}-x_{v_{me}})t-\frac{1}{2}x_{g}t^{2}\\
y_{v_{project}}t=(y_{v_{project}}-y_{P_{me}})+(y_{v_{target}}-y_{v_{me}})t-\frac{1}{2}y_{g}t^{2}\\
z_{v_{project}}t=(z_{v_{project}}-z_{P_{me}})+(z_{v_{target}}-z_{v_{me}})t-\frac{1}{2}z_{g}t^{2}
\end{cases}\tag{5}$$

方程两边同时平方可得：
$${||v_{project}||}^{2}{t}^{2}={||P_{target}-P_{me}||}^{2}+{||v_{target}-v_{me}||}^{2}{t}^{2}\\+\frac{1}{4}{||g||}^{2}{t}^{4}+(P_{target}-P_{me})\cdot(v_{target}-v_{me})t\\- \frac{1}{2}(P_{target}-P_{me})\cdot gt^{2}-\frac{1}{2}(v_{target}-v_{me}) \cdot gt^{3} \tag{6}$$

令：
$$dis=P_{target}-P_{me}\tag{7}$$
$$v_{r}=v_{target}-v_{me}\tag{8}$$
带入原方程得：
$${||v_{project}||}^{2}{t}^{2}={||dis||}^{2}+{||v_{r}||}^{2}{t}^{2}\\+\frac{1}{4}{||g||}^{2}{t}^{4}+dis\cdot(v_{r})t\\- \frac{1}{2}dis\cdot gt^{2}-\frac{1}{2}(v_{r}) \cdot gt^{3} \tag{9}$$
变成一元四次方程组:

$$\frac{1}{4}{||g||}^{2}{t}^{4}-\frac{1}{2}v_{r}\cdot gt^{3}+({||v_{r}||}^{2}-\frac{1}{2}dis\cdot g\\-{||v_{project}||}^{2}){t}^{2}+dis\cdot(v_{r})t+{||dis||}^{2}=0 \tag{10}$$

当重力 $g$为0的时候(太空中，空域平坦区域)，方程课简化为：

$$({||v_{r}||}^{2}-{||v_{project}||}^{2}){t}^{2}+dis\cdot(v_{r})t+{||dis||}^{2}=0 \tag{11}$$


