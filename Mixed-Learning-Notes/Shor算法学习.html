<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>&#x80CC;&#x666F;</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-body vscode-light">
        <p><strong><center><font face="微软雅黑" size=10>Shor算法学习</font></center></strong></p>
<p>代码（作者：Microsoft）：[<a href="https://github.com/microsoft/Quantum/tree/main/samples/algorithms/integer-factorization">https://github.com/microsoft/Quantum/tree/main/samples/algorithms/integer-factorization</a>]</p>
<p>翻译与整理：B20200342吕征宇 @北京科技大学 2020/11/15</p>
<h1 id="背景">背景</h1>
<p>来源于[<a href="https://baike.baidu.com/item/RSA%E7%AE%97%E6%B3%95/263310">https://baike.baidu.com/item/RSA算法/263310</a>]</p>
<p>RSA公开密钥密码体制是一种使用不同的加密密钥与解密密钥，“由已知加密密钥推导出解密密钥在计算上是不可行的”密码体制。
在公开密钥密码体制中，加密密钥（即公开密钥）PK是公开信息，而解密密钥（即秘密密钥）SK是需要保密的。加密算法E和解密算法D也都是公开的。虽然解密密钥SK是由公开密钥PK决定的，但却不能根据PK计算出SK。</p>
<p>正是基于这种理论，1978年出现了著名的RSA算法，它通常是先生成一对RSA密钥，其中之一是保密密钥，由用户保存；另一个为公开密钥，可对外公开，甚至可在网络服务器中注册。为提高保密强度，RSA密钥至少为500位长，一般推荐使用1024位。这就使加密的计算量很大。为减少计算量，在传送信息时，常采用传统加密方法与公开密钥加密方法相结合的方式，即信息采用改进的DES或IDEA对话密钥加密，然后使用RSA密钥加密对话密钥和信息摘要。</p>
<p>RSA的安全性依赖于大数分解，但是否等同于大数分解一直未能得到理论上的证明，也并没有从理论上证明破译。RSA的难度与大数分解难度等价。因为没有证明破解RSA就一定需要做大数分解。假设存在一种无须分解大数的算法，那它肯定可以修改成为大数分解算法，即RSA的重大缺陷是无法从理论上把握它的保密性能如何，而且密码学界多数人士倾向于因子分解不是NPC问题。</p>
<p>通常求解大数分解（通常被认为是NP问题，但是现在有人证明其实是个P问题）最快需要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>e</mi><mrow><mn>1.9</mn><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext> </mtext><mi>N</mi><msup><mo stretchy="false">)</mo><mfrac><mn>1</mn><mn>3</mn></mfrac></msup><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext> </mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext> </mtext><mi>N</mi><msup><mo stretchy="false">)</mo><mfrac><mn>2</mn><mn>3</mn></mfrac></msup></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(e^{1.9(log\ N)^{\frac{1}{3}}(log\ log\ N)^{\frac{2}{3}}})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4701449999999998em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.2201449999999998em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">.</span><span class="mord mtight">9</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.224492857142857em;"><span style="top:-3.48775em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.03144em;"><span style="top:-2.468em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.387em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.532em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span></span></span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mclose mtight"><span class="mclose mtight">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.224492857142857em;"><span style="top:-3.48775em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size1 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.03144em;"><span style="top:-2.468em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.387em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.532em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size1 size6"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>这种时间量级。而目前出现的Shor算法则是需要花费 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mtext> </mtext><mi>N</mi><msup><mo stretchy="false">)</mo><mn>3</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O((log\ N)^{3})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>的时间，实现了指数级别的加速（最快的因数分解算法：普通数域筛选法）。</p>
<p>但从这个角度来说，量子计算并没有使得计算能从NP问题变成P问题。最关键的是现在的量子计算技术还处于发展中的萌芽期，来解决RSA至少需要1024来解决，然而现在量子计算机能够达到拥有1000位的计算比特已经很不错了（只有顶尖的实验室才有）。因此RSA的安全性并没有受到过大的威胁。</p>
<h1 id="算法的原理">算法的原理</h1>
<p>来源于[<a href="https://zh.wikipedia.org/wiki/%E7%A7%80%E7%88%BE%E6%BC%94%E7%AE%97%E6%B3%95">https://zh.wikipedia.org/wiki/秀爾演算法</a>]</p>
<h2 id="解释">解释</h2>
<p>此算法包含两个部分。算法的第一部分是将因数分解问题转成查找一个函数的周期，而且这部分可以用传统方式实现。第二部分则是使用量子傅里叶变换来搜索这个函数的周期，而且这一部分是量子加速这整个算法的理由。</p>
<p>Shor算法包含两个部分：</p>
<ol>
<li>一个以传统电脑运作的简化算法，将因数分解简化成搜索阶问题。</li>
<li>一个量子算法，解决搜索阶问题。</li>
</ol>
<h3 id="从周期得到因数">从周期得到因数</h3>
<p>小于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> 且互质于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> 的整数组成一个有限大，且对乘法同余 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> 的群。</p>
<p>我们有一个属于这个群的整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>。</p>
<p>既然这个群是有限的，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span> 必有一个有限大的阶 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> , 也就是最小的正整数令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>r</mi></msup><mo>≡</mo><mn>1</mn><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">a^{r}\equiv 1\ mod\ N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>，因此可知，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>r</mi></msup><mtext>−</mtext><mn>1</mn></mrow><annotation encoding="application/x-tex">a^{r}− 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.747722em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span></span><span class="mord">−</span><span class="mord">1</span></span></span></span>的因数。先假设我们有能力获得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>，而且<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>是偶数。</p>
<p>则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>r</mi></msup><mtext>−</mtext><mn>1</mn><mo>=</mo><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>≡</mo><mn>0</mn><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>N</mi><mo>=</mo><mo>&gt;</mo><mi>N</mi><mi mathvariant="normal">∣</mi><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a^{r}− 1=(a^{\frac{r}{2}}+1)(a^{\frac{r}{2}}-1)\equiv 0\ mod\ N =&gt; N|(a^{\frac{r}{2}}+1)(a^{\frac{r}{2}}-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.747722em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span></span><span class="mord">−</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord">∣</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> 是令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>a</mi><mi>r</mi></msup><mo>≡</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a^{r}\equiv 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>最小的正整数，所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{\frac{r}{2}}-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>必定不能整除于N。若<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{\frac{r}{2}}+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>也不整除于N的话，则N必定与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{\frac{r}{2}}+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>或者<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msup><mi>a</mi><mfrac><mi>r</mi><mn>2</mn></mfrac></msup><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(a^{\frac{r}{2}}-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.09708em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.84708em;"><span style="top:-3.363em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6915428571428572em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>有一个非显然的公因数。</p>
<h3 id="找寻周期">找寻周期</h3>
<p>Shor的周期查找算法非常倚赖量子计算机同时计算许多状态的能力。物理学家称呼这个特性为这一些状态的&quot;叠加&quot;。在计算函数f的周期时，我们会同时估计这个函数的所有点。</p>
<p>不过，量子物理不允许我们直接获取这一些信息。测量会令观测结果塌陷到其中一个可能的结果，并摧毁其他可能性的存在。解决这些麻烦的问题，采用在这里我们使用量子傅里叶变换来达成。</p>
<p>因此Shor在这里必须解决三个&quot;实现&quot;的问题。这一些问题都必须要有很快的实现，或者说他们可以用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mtext> </mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">log\ N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span> 的多项式个数这么多量子门来实现。</p>
<ol>
<li>制造状态的叠加。</li>
<li>以量子变换实现函数f。这一步需要多一倍的量子位进行辅助。</li>
<li>进行量子傅里叶变换。这一步之后，观察结果会逼近周期r。</li>
</ol>
<p>另一种解释Shor算法的方式是将之视为是量子相位估计算法的一种变形。从实现的角度来说，量子部分就在估算周期和相位上去了，而留给经典的计算来说，只是做了一个验证而已。</p>
<h1 id="主函数执行部分">主函数执行部分</h1>
<p>此示例包含实现Shor整数因式分解的量子算法的Q#代码。基于Stephane Beauregard的一篇论文，基本的模块化算法是在相位编码中实现的，他给出了一个量子电路需要 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2n+3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> 个量子位和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n^{3}log(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>的基本量子门来进行对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>比特数的因式分解。</p>
<h2 id="主函数--factorsemiprimeinteger">主函数  FactorSemiprimeInteger</h2>
<p>使用 Shor 算法去分解参数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>。
主要原理就是分解一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>，使得 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>=</mo><mi>p</mi><mo>⋅</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">N=p \cdot q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span>。
找到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 、 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">q &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，然后完成分解。</p>
<h3 id="输入">输入</h3>
<ul>
<li>
<p>number</p>
<p>数字<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>：一个待分解半素数</p>
</li>
<li>
<p>useRobustPhaseEstimation</p>
<p>如果设置为true，则使用 Microsoft.Quantum.Characterization.RobustPhaseEstimation 以及 Microsoft.Quantum.Characterization.QuantumPhaseEstimation, 否则则使用其他的方法</p>
</li>
</ul>
<h3 id="输出">输出</h3>
<ul>
<li>
<p>一对数</p>
<p>满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">p &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 、 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">q &gt; 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335400000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>⋅</mo><mi>q</mi><mo>=</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">p \cdot q = N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></p>
</li>
</ul>
<h3 id="代码">代码</h3>
<pre><code class="language-Javascript"><div>operation FactorSemiprimeInteger(number : Int, <span class="hljs-attr">useRobustPhaseEstimation</span> : Bool) : (Int, Int) {
    <span class="hljs-comment">//如果提供的数字是偶数，首先检查最简单的情况</span>
    <span class="hljs-keyword">if</span> (number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
        Message(<span class="hljs-string">&quot;An even number has been given; 2 is a factor.&quot;</span>);
        <span class="hljs-keyword">return</span> (number / <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
    }
    <span class="hljs-comment">//如果我们找到了这些可变因素，那么这些可变变量将跟踪这些因素是什么。</span>
    mutable foundFactors = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">//因子的默认值是 (1,1).</span>
    mutable factors = (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    repeat {
        <span class="hljs-comment">//下一步试着把一个数的余素数猜成&#x27;number&#x27;</span>
        <span class="hljs-comment">//在区间[1,number-1]中获取一个随机整数</span>
        <span class="hljs-keyword">let</span> generator = DrawRandomInt(<span class="hljs-number">1</span>, number - <span class="hljs-number">1</span>);
        <span class="hljs-comment">//检查随机整数是否真的使用 Microsoft.Quantum.Math.IsCoprimeI。</span>
        <span class="hljs-comment">//如果为真，则使用量子算法进行周期查找。</span>
        <span class="hljs-keyword">if</span> (IsCoprimeI(generator, number)) {
            <span class="hljs-comment">//使用 Microsoft.Quantum.Intrinsic.Message打印信息</span>
            <span class="hljs-comment">//表明我们正在用量子方法进行处理</span>
            Message($<span class="hljs-string">&quot;Estimating period of {generator}&quot;</span>);
            <span class="hljs-comment">//调用`generator` mod &#x27;number&#x27;的量子周期查找算法。</span>
            <span class="hljs-comment">//这里我们可以选择使用哪种相位估计算法。</span>
            <span class="hljs-keyword">let</span> period = EstimatePeriod(generator, number, useRobustPhaseEstimation);
            <span class="hljs-comment">//如果辗转相除成功，则设置标志和因数。</span>
            set (foundFactors, factors) = MaybeFactorsFromPeriod(number, generator, period);
        }
        <span class="hljs-comment">//在这个例子中，我们意外地猜到了除数。</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//使用Microsoft.Quantum.Math.GreatestCommonDivisorI</span>
            <span class="hljs-comment">//来发现最大公约数</span>
            <span class="hljs-keyword">let</span> gcd = GreatestCommonDivisorI(number, generator);
            <span class="hljs-comment">//别忘了告诉用户我们很幸运，没有做任何量子运算。</span>
            <span class="hljs-comment">//通过Microsoft.Quantum.Intrinsic.Message.发送消息</span>
            Message($<span class="hljs-string">&quot;We have guessed a divisor of {number} to be {gcd} by accident.&quot;</span>);
            <span class="hljs-comment">//将标志“foundFactors”设置为true，表示我们成功地找到了因子。</span>
            set foundFactors = <span class="hljs-literal">true</span>;
            set factors = (gcd, number / gcd);
        }
    }
    until (foundFactors)
    fixup {
        Message(<span class="hljs-string">&quot;The estimated period did not yield a valid factor, trying again.&quot;</span>);
    }
    <span class="hljs-comment">// 返回分解结果</span>
    <span class="hljs-keyword">return</span> factors;
}
</div></code></pre>
<h1 id="量子计算部分">量子计算部分</h1>
<h2 id="函数-applyorderfindingoracle">函数 ApplyOrderFindingOracle</h2>
<p>将<code>target</code>转化为无符号小端存储的整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 进行编码，并执行转换 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>k</mi><mo stretchy="false">⟩</mo><mo>↦</mo><mi mathvariant="normal">∣</mi><msup><mi>g</mi><mi>p</mi></msup><mi>k</mi><mspace></mspace><mspace width="0.6666666666666666em"/><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow><mtext> </mtext><mtext> </mtext><mtext> </mtext><mi>N</mi><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">|k⟩↦| g^{p}k\mod\ N⟩</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mclose">⟩</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">↦</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace allowbreak"></span><span class="mspace" style="margin-right:0.6666666666666666em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mclose">⟩</span></span></span></span> ，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span>是“power”，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>是“generator”，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>是“module”。</p>
<h3 id="输入-1">输入</h3>
<ul>
<li>
<p>generator</p>
<p>正被估计其乘法阶（周期）的无符号整数。必须是<code>number</code>的共质数。</p>
</li>
<li>
<p>number</p>
<p>这个就是原数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></p>
</li>
<li>
<p>power</p>
<p><code>generator</code>的幂，是<code>target</code>所需要的位数</p>
</li>
<li>
<p>target</p>
<p>小端存储的寄存器，位数是<code>generator</code>的指数，倍数则是通过对<code>number</code>取模得来的。</p>
</li>
</ul>
<h3 id="代码-1">代码</h3>
<pre><code class="language-Javascript"><div>operation ApplyOrderFindingOracle(generator : Int, <span class="hljs-attr">number</span> : Int, <span class="hljs-attr">power</span> : Int, <span class="hljs-attr">target</span> : Qubit[]): Unit is Adj + Ctl {
    <span class="hljs-comment">//检查参数是否安全</span>
    Fact(IsCoprimeI(generator, number), <span class="hljs-string">&quot;`generator` and `number` must be co-prime&quot;</span>);
    <span class="hljs-comment">//我们用&quot;黑盒&quot; 去做顺序发现是</span>
    <span class="hljs-comment">//通过Microsoft.Quantum.Arithmetic.MultiplyByModularInteger封装的</span>
    <span class="hljs-comment">//其实现为 |x⟩ ↦ |x⋅a mod N ⟩</span>
    MultiplyByModularInteger(ExpModI(generator, power, number), number, LittleEndian(target));
}
</div></code></pre>
<h2 id="函数-estimateperiod">函数 EstimatePeriod</h2>
<p>通过 Z mod <code>number</code>，来得到周期。</p>
<h3 id="输入-2">输入</h3>
<ul>
<li>
<p>generator</p>
<p>正被估计其乘法阶（周期）的无符号整数。必须是<code>number</code>的共质数。</p>
</li>
<li>
<p>number</p>
<p>这个就是原数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>。</p>
</li>
<li>
<p>useRobustPhaseEstimation</p>
<p>决定是否使用微软自己的稳定相位估计方法。</p>
</li>
</ul>
<h3 id="输出-1">输出</h3>
<p>通过<code>generator</code> mod <code>number</code>得到周期</p>
<h3 id="代码-2">代码</h3>
<pre><code class="language-Javascript"><div>operation EstimatePeriod(generator : Int, <span class="hljs-attr">number</span> : Int, <span class="hljs-attr">useRobustPhaseEstimation</span> : Bool) : Int {
     Here we check that the inputs to the EstimatePeriod operation are valid.
    Fact(IsCoprimeI(generator, number), <span class="hljs-string">&quot;`generator` and `number` must be co-prime&quot;</span>);
    <span class="hljs-comment">//存储到目前为止找到的生成器周期的除数的变量。</span>
    mutable result = <span class="hljs-number">1</span>;
    <span class="hljs-comment">//我们估计周期所依据的位数中的位数。</span>
    <span class="hljs-keyword">let</span> bitsize = BitSizeI(number);
    <span class="hljs-comment">//EstimatePeriod操作通过找到小数s/r的近似k/2^（bits precision）来估计周期r，其中s是某个整数。</span>
    <span class="hljs-comment">//请注意，如果s和r有公约数，我们将最终恢复r的一个除数，而不是r本身。</span>
    <span class="hljs-comment">//然而，如果我们恢复足够多的r除数，我们很快就能恢复r本身。</span>
    <span class="hljs-keyword">let</span> bitsPrecision = <span class="hljs-number">2</span> * bitsize + <span class="hljs-number">1</span>;
    mutable frequencyEstimate = <span class="hljs-number">0</span>;
    repeat {

        set frequencyEstimate = EstimateFrequency(
            generator, number, useRobustPhaseEstimation, bitsize 
        );

        <span class="hljs-keyword">if</span> (frequencyEstimate != <span class="hljs-number">0</span>) {
            set result = PeriodFromFrequency(number,frequencyEstimate, bitsPrecision, result);
        }
        <span class="hljs-keyword">else</span> {
            Message(<span class="hljs-string">&quot;The estimated frequency was 0, trying again.&quot;</span>);
        }
    }
    until(ExpModI(generator, result, number) == <span class="hljs-number">1</span>)
    fixup {
        Message(<span class="hljs-string">&quot;The estimated period from continued fractions failed, trying again.&quot;</span>);
    }

    <span class="hljs-keyword">return</span> result;
}
</div></code></pre>
<h2 id="函数-estimatefrequency">函数 EstimateFrequency</h2>
<p>通过 Z mod <code>number</code>，来得到频率。</p>
<h3 id="输入-3">输入</h3>
<ul>
<li>
<p>generator</p>
<p>正被估计其乘法阶（周期）的无符号整数。必须是<code>number</code>的共质数。</p>
</li>
<li>
<p>number</p>
<p>这个就是原数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>。</p>
</li>
<li>
<p>useRobustPhaseEstimation</p>
<p>如果设置为<code>真</code>，那么就采用微软自己的函数进行周期估计（以此来计算频率）</p>
</li>
<li>
<p>bitsize</p>
<p>需要表示这个数所用的量子比特位</p>
</li>
</ul>
<h3 id="输出-2">输出</h3>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>k</mi><msup><mn>2</mn><mrow><mi>b</mi><mi>i</mi><mi>t</mi><mi>s</mi><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msup></mfrac></mrow><annotation encoding="application/x-tex">\frac {k}{2^{bitsPrecision}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7751079999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>中最接近</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>s</mi><mi>r</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{s}{r}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7935600000000003em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.10756em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>的分子<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span>。</p>
<h3 id="代码实现">代码实现</h3>
<pre><code class="language-Javascript"><div>operation EstimateFrequency(generator : Int, <span class="hljs-attr">number</span> : Int,<span class="hljs-attr">useRobustPhaseEstimation</span> : Bool, <span class="hljs-attr">bitsize</span> : Int): Int {
    mutable frequencyEstimate = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> bitsPrecision =  <span class="hljs-number">2</span> * bitsize + <span class="hljs-number">1</span>;
    <span class="hljs-comment">//为周期发现中使用的`黑箱`本征态叠加分配量子位。</span>
    using (eigenstateRegister = Qubit[bitsize]) {
        <span class="hljs-comment">//将eigenstateRegister初始化为1，这是我们估计其相位的本征态的叠加。</span>
        <span class="hljs-comment">//我们首先将寄存器定为对无符号整数进行小端编码存取。</span>
        <span class="hljs-keyword">let</span> eigenstateRegisterLE = LittleEndian(eigenstateRegister);
        ApplyXorInPlace(<span class="hljs-number">1</span>, eigenstateRegisterLE);
        <span class="hljs-comment">//使用离散 oracle，以便之后进行相位分析</span>
        <span class="hljs-keyword">let</span> oracle = DiscreteOracle(ApplyOrderFindingOracle(generator, number, _, _));
        <span class="hljs-comment">//如果打算使用稳定的相位估计</span>
        <span class="hljs-keyword">if</span> (useRobustPhaseEstimation) {
            <span class="hljs-comment">//使用RobustPhaseEstimation估计s/r.</span>
            <span class="hljs-comment">//它只需要一个额外的量子位，但是却需要几个oracle</span>
            <span class="hljs-keyword">let</span> phase = RobustPhaseEstimation(bitsPrecision, oracle, eigenstateRegisterLE!);
            <span class="hljs-comment">//计算k/2^bitsPrecision中最接近s/r的分子k。</span>
            <span class="hljs-comment">//注意，相位估计投射在随机s对应的本征态上。</span>
            set frequencyEstimate = Round(((phase * IntAsDouble(<span class="hljs-number">2</span> ^ bitsPrecision)) / <span class="hljs-number">2.0</span>) / PI());
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//使用QuantumPhaseEstimation去估计s/r</span>
            <span class="hljs-comment">//这里，所需要的代价就是额外`bitsPrecision`的量子位</span>
            using (register = Qubit[bitsPrecision]) {
                <span class="hljs-keyword">let</span> frequencyEstimateNumerator = LittleEndian(register);  
                <span class="hljs-comment">//包含并元分数k/2^bit精度的分子k的寄存器。</span>
                <span class="hljs-comment">//分子是一个用big-endian格式编码的无符号整数。</span>
                <span class="hljs-comment">//使用Microsoft.Quantum.Arithmetic.BigEndian实现。</span>
                QuantumPhaseEstimation(
                    oracle, eigenstateRegisterLE!, LittleEndianAsBigEndian(frequencyEstimateNumerator)
                ); 
                <span class="hljs-comment">//直接测量并矢分数k/2^bit精度近似s/r的分子k。</span>
                <span class="hljs-comment">//注意相位估计投射在随机s对应的本征态上。</span>
                set frequencyEstimate = MeasureInteger(frequencyEstimateNumerator);
            }
        }
        <span class="hljs-comment">// 退回所有用于oracle“黑箱”本征态背，并且将它置为0态</span>
        ResetAll(eigenstateRegister);
    }

    <span class="hljs-keyword">return</span> frequencyEstimate;
}
</div></code></pre>
<h1 id="经典计算部分">经典计算部分</h1>
<h2 id="函数-maybefactorsfromperiod">函数 MaybeFactorsFromPeriod</h2>
<p>通过给定的<code>period</code>和<code>generator</code>试图找出<code>number</code>的因数。</p>
<h3 id="输入-4">输入</h3>
<ul>
<li>
<p>number</p>
<p>这个就是原数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></p>
</li>
<li>
<p>generator</p>
<p>正在估计其乘法阶（周期）的无符号整数。必须与<code>number</code>有共同的质数。</p>
</li>
<li>
<p>period</p>
<p>估计周期（乘法阶）通过 <code>generator</code> mod <code>number</code> 实现</p>
</li>
</ul>
<h3 id="输出-3">输出</h3>
<p>指示是否成功找到因子的标志的元组，以及表示找到的因子的一对整数。请注意，第二个输出只有在第一个输出为<code>真</code>时才有意义。</p>
<ul>
<li>可以去看 Microsoft.Quantum.Math.GreatestCommonDivisorI</li>
</ul>
<h3 id="代码实现-1">代码实现</h3>
<pre><code class="language-Javascript"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MaybeFactorsFromPeriod</span>(<span class="hljs-params">number : Int, generator : Int, period : Int</span>) : (<span class="hljs-params">Bool, (Int, Int)</span>) </span>{
    <span class="hljs-comment">//只有当周期为偶数时，才能归结为因子分解</span>
    <span class="hljs-keyword">if</span> (period % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">//计算 `generator` ^ `period/2` mod `number`</span>
        <span class="hljs-keyword">let</span> halfPower = ExpModI(generator, period / <span class="hljs-number">2</span>, number);
        <span class="hljs-comment">//如果运气不好，半幂就是-1模N，这是一个对因式分解没有用处的例子。</span>
        <span class="hljs-keyword">if</span> (halfPower != number - <span class="hljs-number">1</span>) {
            <span class="hljs-comment">//当半幂不是-1模N半幂-1或半幂+1与N共同的享非平凡除数。</span>
            <span class="hljs-keyword">let</span> factor = MaxI(
                GreatestCommonDivisorI(halfPower - <span class="hljs-number">1</span>, number),
                GreatestCommonDivisorI(halfPower + <span class="hljs-number">1</span>, number)
            );
            <span class="hljs-comment">//添加一个我们找到因子的标志，并返回计算出的非平凡因子。</span>
            <span class="hljs-keyword">return</span> (<span class="hljs-literal">true</span>, (factor, number / factor));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//返回一个标志，表明我们遇到了一个小问题，没有得到任何因子。</span>
            <span class="hljs-keyword">return</span> (<span class="hljs-literal">false</span>, (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">//当周期为奇数时，我们必须选择另一个&#x27;generator&#x27;</span>
        <span class="hljs-comment">//来估计周期并重新启动。</span>
        Message(<span class="hljs-string">&quot;Estimated period was odd, trying again.&quot;</span>);
        <span class="hljs-keyword">return</span> (<span class="hljs-literal">false</span>, (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>));
    }
}
</div></code></pre>
<h2 id="函数-periodfromfrequency">函数 PeriodFromFrequency</h2>
<p>从输入频率中求一个数的周期。</p>
<h3 id="输入-5">输入</h3>
<ul>
<li>
<p>number</p>
<p><code>number</code> 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>，用于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">Z\ mod\ N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>，其中<code>generator</code>的乘法阶是被估计的。</p>
</li>
<li>
<p>frequencyEstimate</p>
<p>我们要转换成周期的频率。</p>
</li>
<li>
<p>bitsPrecision</p>
<p>使用连分式算法估计s/r以恢复周期r所需的精度位数。</p>
</li>
<li>
<p>currentDivisor</p>
<p>到目前为止发现的生成周期的除数。</p>
</li>
</ul>
<h3 id="输出-4">输出</h3>
<p>通过连分式算法根据估计的频率计算出的周期。</p>
<h3 id="代码-3">代码</h3>
<pre><code class="language-Javascript"><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PeriodFromFrequency</span>(<span class="hljs-params">number : Int, frequencyEstimate : Int, bitsPrecision : Int, currentDivisor : Int</span>): <span class="hljs-title">Int</span> </span>{
    <span class="hljs-comment">// 现在我们可以用ContinuedFractionConvergentI函数来发现</span>
    <span class="hljs-comment">// k/2^bitsPrecision中最接近s/r的小数</span>
    <span class="hljs-keyword">let</span> (numerator, period) = (ContinuedFractionConvergentI(Fraction(frequencyEstimate, <span class="hljs-number">2</span> ^ bitsPrecision), number))!;
    <span class="hljs-comment">//ContinuedFractionConvergentI不保证分子和分母的符号。</span>
    <span class="hljs-comment">//这里使用AbsI来保证它们都是正的。</span>
    <span class="hljs-keyword">let</span> (numeratorAbs, periodAbs) = (AbsI(numerator), AbsI(period));
    <span class="hljs-comment">//使用GreatestCommonDivisorI返回新的除数</span>
    <span class="hljs-keyword">return</span> (periodAbs * currentDivisor) / GreatestCommonDivisorI(currentDivisor, periodAbs);
}
</div></code></pre>
<h1 id="官方的一些函数简介">官方的一些函数简介</h1>
<h2 id="greatestcommondivisori">GreatestCommonDivisorI</h2>
<p>Microsoft.Quantum.Math.GreatestCommonDivisorI</p>
<p>用于寻找最大公约数</p>
<p>算符表达为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p=gcd(a,b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">c</span><span class="mord mathdefault">d</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mclose">)</span></span></span></span></p>
<h2 id="expmodi">ExpModI</h2>
<p>Microsoft.Quantum.Math.ExpModI</p>
<p>输入是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> , <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></p>
<p>结果为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>s</mi><mi>u</mi><mi>l</mi><mi>t</mi><mo>=</mo><msup><mi>a</mi><mi>p</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>N</mi></mrow><annotation encoding="application/x-tex">Result=a^{p}\ mod\ N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></p>
<h2 id="absi">AbsI</h2>
<p>Microsoft.Quantum.Math.AbsI</p>
<p>整数取绝对值</p>
<h2 id="continuedfractionconvergenti">ContinuedFractionConvergentI</h2>
<p>Microsoft.Quantum.Math.ContinuedFractionConvergentI</p>
<p>查找最接近于 fraction 分母小于或等于的连续分数收敛性 denominatorBound</p>
<ul>
<li>输入
分式： 分数
denominatorBound： Int</li>
<li>输出： 分数
最接近的分数， fraction 分母小于或等于 denominatorBound</li>
</ul>
<h2 id="fraction">Fraction</h2>
<p>Microsoft.Quantum.Math.Fraction</p>
<p>表示形式的有理数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi mathvariant="normal">/</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">p/q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> 。 整数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span> 是元组的第一个元素， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span></span></span></span> 是元组的第二个元素。</p>
<h2 id="resetall">ResetAll</h2>
<p>Microsoft.Quantum.Intrinsic.ResetAll</p>
<p>给定一个 qubits 数组，对其进行度量，确保它们处于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mn>0</mn><mo stretchy="false">⟩</mo></mrow><annotation encoding="application/x-tex">| 0 ⟩</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord">0</span><span class="mclose">⟩</span></span></span></span>状态，以便可以安全地释放它们。</p>
<h2 id="discreteoracle">DiscreteOracle</h2>
<p>Microsoft.Quantum.Oracles.DiscreteOracle</p>
<p>表示离散 oracle。这是一种 oracle，它实现 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>U</mi><mi>m</mi></msup><mi>U</mi></mrow><annotation encoding="application/x-tex">U^{m}U</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span></span></span></span>的固定操作和非负 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> 整数。</p>
<h2 id="robustphaseestimation">RobustPhaseEstimation</h2>
<p>Microsoft.Quantum.Characterization.RobustPhaseEstimation</p>
<p>为给定的 oracle 和 eigenstate 执行稳健的非迭代量程阶段估算算法 U ，并提供针对海森堡限制处的变化缩放阶段的单个实际值估算。</p>
<h2 id="quantumphaseestimation">QuantumPhaseEstimation</h2>
<p>Microsoft.Quantum.Characterization.QuantumPhaseEstimation</p>
<p>量子相位估计，执行给定 oracle 和的量程阶段估算算法 U ，并将 targetState 该阶段读入大字节序量程寄存器。</p>

    </body>
    </html>